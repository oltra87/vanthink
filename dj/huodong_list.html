<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta charset="utf-8">
    <title>活动专区_迪佳百川俱乐部</title>
    <link rel="stylesheet" href="http://www.ticaglobal.cn/themes/default/statics/css/ectouch.css" />
    <script type="text/javascript" >var tpl = '/themes/default';</script>
    <!-- ********************************** 样式 Start （样式统一添加在此处） ***************************************  -->
    <style>
        .huodong_list{ font-size:1.5rem; }
        .huodong_list li{ box-sizing: border-box; padding:3%; background: #fff;  margin-bottom: 10px; }
        .huodong_list img{ width: 100%; }
        .huodong_list div:after{ display: block; clear: both; content: '';}
        .huodong_list h4{ width:75%; display: inline-block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .huodong_list h4 p{ font-size: 1.3rem; color: #aaa; }
        .huodong_list span{ display: inline-block; background: #007AFF; color: #fff;  width: 20%; padding: 0.5rem; text-align: center; border-radius: 3px; float: right; }
        .huodong_list span.over{ background: #e6e6e6; color: #666; }
        .huodong_list span.ready{ background: #1cbb7f; }
    </style>
    <!-- ********************************** 样式 Start ***************************************  -->
</head>

<body style="max-width:640px;">
<div id="loading"><img src="http://www.ticaglobal.cn/themes/default/statics/img/loading.gif" /></div>
<div class="con m-b7 new-maxbox" >	<style>
    a.a-sequence {width: 3.5rem;height: 0rem;line-height: 3rem;margin-left:0.5rem;}
    a.s-filter {line-height: 3rem;padding-left: 0rem;}
</style>
    <div class="con">
        <div class="category">
            <section class="search">
                <div class="text-all dis-box j-text-all text-all-back">
                    <a class="a-icon-back j-close-search" href="javascript:history.go(-1)"><i class="iconfont icon-jiantou is-left-font"></i></a>
                    <div class="box-flex input-text n-input-text i-search-input">
                        <a class="a-search-input j-search-input" href="javascript:void(0)"></a>
                        <i class="iconfont icon-sousuo"></i>
                        <input class="j-input-text" type="text" placeholder="请输入您搜索的关键词!">
                        <i class="iconfont icon-guanbi1 is-null j-is-null"></i>
                    </div>
                </div>
            </section>

            <section class="huodong_list">
                <ul>
                    <li>
                        <a href="#">
                            <img src="https://img1.360buyimg.com/da/jfs/t10543/146/2582698194/100075/9301cee/59f983ccN62438606.jpg">
                            <div>
                                <span>进行中</span>
                                <h4>
                                    这里是活动名称哟
                                    <p>2017.11.06 至 2017.12.31</p>
                                </h4>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <img src="https://m.360buyimg.com/mobilecms/s1125x549_jfs/t9649/199/2582101011/170427/e8cc1697/59fb0f8dN7a14219c.jpg!q70.jpg">
                            <div>
                                <span class="ready">即将开始</span>
                                <h4>
                                    这里是活动名称哟
                                    <p>2017.11.06 至 2017.12.31</p>
                                </h4>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <img src="https://m.360buyimg.com/mobilecms/s1125x549_jfs/t10948/127/2714940088/148429/6c591da2/59fc188dN8d57f74b.jpg!q70.jpg">
                            <div>
                                <span class="over">已结束</span>
                                <h4>
                                    迪佳商城元旦全场满200减50
                                    <p>2017.01.01 至 2017.01.03</p>
                                </h4>
                            </div>
                        </a>
                    </li>
                </ul>
            </section>
        </div>
    </div>


    <div class="filter-top" id="scrollUp">
        <i class="iconfont icon-dingbu"></i>
    </div>

    <footer class="footer-nav dis-box">
        <a href="/index.php?m=default&c=index&a=index&u=0" class="box-flex nav-list">
            <i class="nav-box i-home"></i><span>首页</span>
        </a>
        <a href="/index.php?m=default&c=category&a=top_all&u=0" class="box-flex nav-list">
            <i class="nav-box i-cate"></i><span>分类</span>
        </a>

        <a href="/index.php?m=default&c=flow&a=cart&u=0" class="box-flex position-rel nav-list">
            <i class="nav-box i-flow"></i><span>购物车</span>
        </a>
        <a href="/index.php?m=default&c=user&a=index&u=0" class="box-flex nav-list">
            <i class="nav-box i-user"></i><span>我的</span>
        </a>
    </footer>

    <div id="j-filter-div" class="j-filter-div filter-div ts-5 c-filter-div">
        <div class="mask-filter-div"></div>
        <section class="close-filter-div j-close-filter-div">
            <div class="close-f-btn">
                <i class="iconfont icon-fanhui"></i>
                <span>关闭</span>
            </div>
        </section>
        <section class="con-filter-div">
            <form class="hold-height" method="post" id="form" action="/index.php?m=default&c=category&a=index&u=0">
                <input type="hidden" name="id" class="cat" value="4" />
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <div class="price-range padding-all m-top08">
                            <label>价格</label>
                            <div class="price-slider">
                                <div id="slider-range" class="slider"></div>
                                <div class="slider-info">
                                    <span id="slider-range-amount"></span>
                                </div>
                            </div>
                            <input type="hidden" id="min" name="price_min" value="0" />
                            <input type="hidden" id="max" name="price_max" value="0" />
                        </div>
                        <div class="select-two">
                            <a class="select-title padding-all j-menu-select">
                                <label class="fl">品牌</label>
						<span class="fr t-jiantou j-t-jiantou jian001" id="j-t-jiantou"><em class="fl">


                            全部


                        </em><i class="iconfont icon-jiantou tf-180 ts-2"></i></span>
                            </a>
                            <ul class="j-sub-menu padding-all j-get-one" data-istrue="true">
                                <li class="ect-select" data-attr="0">
                                    <label class="ts-1">全部<i class="fr iconfont icon-gou ts-1"></i></label>
                                </li>
                                <li class="ect-select" data-attr="1">
                                    <label class="ts-1">迪佳/TICA<i class="fr iconfont icon-gou ts-1"></i></label>
                                </li>
                                <input type="hidden" name="brand" value="0" />
                            </ul>
                            <input type="hidden" id="filter_attr" name="filter_attr" value="0" />
                        </div>
                        <div class="ect-button-more dis-box padding-all">
                            <a class="box-flex btn-reset j-filter-reset" onclick="javascript:clear_filter();">清空选项</a>
                            <button type="submit" class="box-flex btn-submit">确定</button>
                        </div>
                    </div>
                </div>
            </form>
        </section>
    </div>

    <script type="text/javascript">
        function clear_filter(){
            $(".touchweb-com_listType .range").text("全部");
            $(".touchweb-com_listType input").each(function() {
                if($(this).attr('class') != 'cat'){
                    $(this).val("");
                }
            });
            $(".ui-slider-handle").css("left","0");
            $(".ui-slider-range").css({left:0,width:0});
            $("#slider-range-amount").html(0);
            $("#min ,#max").val(0);
            $('input[name="brand"]').val(0);
            $("#filter_attr").val(0);
        }


    </script>		<div class="search-div ts-3">
        <section class="search">
            <form action="/index.php?m=default&c=category&a=index&u=0&id=4" method="post">
                <div class="text-all dis-box j-text-all">
                    <a class="a-icon-back j-close-search" href="javascript:history.go(-1)"><i class="iconfont icon-jiantou is-left-font"></i></a>
                    <div class="box-flex input-text">
                        <input class="j-input-text" type="text" name="name" placeholder="请输入搜索关键词！" id="newinput" autofocus="autofocus"/ >
                        <i class="iconfont icon-guanbi2 is-null j-is-null"></i>
                    </div>
                    <button type="submit" class="btn-submit">搜索</button>
                </div>
            </form>
        </section>
        <section class="search-con">
            <div class="swiper-scroll history-search">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <p>
                            <label class="fl">热门搜索</label>
                        </p>
                        <ul class="hot-search a-text-more">
                        </ul>
                        <p class="hos-search">
                            <label class="fl">最近搜索</label>
                            <span class="fr" onclick="javascript:clearHistroy();"><i class="iconfont icon-xiao10 is-xiao10 jian-top fr"></i></span>
                        </p>

                        <ul class="hot-search a-text-more a-text-one" id="search_histroy">
                        </ul>
                    </div>
                </div>
                <div class="swiper-scrollbar"></div>
            </div>
        </section>
        <footer class="close-search j-close-search">
            点击关闭
        </footer>
    </div>

    <script type="text/javascript">
        //设置cookie
        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays*24*60*60*1000));
            var expires = "expires="+d.toUTCString();
            document.cookie = cname + "=" + cvalue + "; " + expires;
        }
        function clearHistroy(){
            setCookie('ECS[keywords]', '', -1);
            document.getElementById("search_histroy").style.visibility = "hidden";
        }
    </script>		<div class="div-messages"></div>

    <script type="text/javascript" src="http://www.ticaglobal.cn/themes/default/statics/js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="http://www.ticaglobal.cn/themes/default/statics/js/swiper.min.js"></script>
    <script type="text/javascript" src="http://www.ticaglobal.cn/themes/default/statics/js/ectouch.js"></script>
    <script type="text/javascript" src="http://www.ticaglobal.cn/data/assets/js/jquery.json.js"></script>
    <script type="text/javascript" src="http://www.ticaglobal.cn/themes/default/statics/js/jquery-ui-1.10.1.custom.min.js"></script>
    <script type="text/javascript" src="http://www.ticaglobal.cn/themes/default/statics/js/jquery.ui.touch-punch.min.js"></script>
    <script type="text/javascript" src="http://www.ticaglobal.cn/themes/default/statics/js/jquery.scrollUp.min.js"></script>
    <script type="text/javascript" src="http://www.ticaglobal.cn/themes/default/statics/js/jquery.lazyload.min.js"></script>
    <script type="text/javascript" src="http://www.ticaglobal.cn/data/assets/js/common.js"></script>

    <script type="text/javascript" src="http://www.ticaglobal.cn/themes/default/statics/js/echo.min.js"></script>
    <script type="text/javascript" src="http://www.ticaglobal.cn/data/assets/js/template.js"></script>
    <script type="text/javascript">
        $('#hide-div').delay(1500).hide(0);
        var sliders = function() {
            // 筛选价格区间 js
            $("#slider-range").slider({
                range: true,
                min: 0,
                max: 1000,
                step: 100,
                values: [0, 300],
                slide: function(event, ui) {
                    $("#slider-range-amount").text(ui.values[0] + " ~ " + ui.values[1]);
                    $('input[name=price_min]').val(ui.values[0]);
                    $('input[name=price_max]').val(ui.values[1]);
                }
            });
            var price_min = $('input[name=price_min]').val();
            var price_max = $('input[name=price_max]').val();
            $("#slider-range").slider({values: [price_min, price_max]});
            $("#slider-range-amount").text(price_min + " ~ " + price_max);
        }();

        var url = '/index.php?m=default&c=category&a=async_list&id=4&type=&brand=0&price_min=0&price_max=0&filter_attr=0&page=1&sort=sort_order&order=ASC&u=0';
        var total = 0;
        var page = localData.get('cat_4_page');
        page = (page === null) ? 1:parseInt(page);
        // first request
        get_data(page);
        localData.set('cat_4_page', page);
        if(page == 1){
            localData.set('cat_4_page_min', 1);
            localData.set('cat_4_page_max', 1);
        }
        if(page > 1){
            localData.set('cat_4_page_min', page);
            localData.set('cat_4_page_max', page);
        }
        var minPage = localData.get('cat_4_page_max');
        var maxPage = localData.get('cat_4_page_max');
        minPage = (minPage === null) ? 1:parseInt(minPage);
        maxPage = (maxPage === null) ? 1:parseInt(maxPage);

        $(window).scroll(function () {
            var scrollTop = $(this).scrollTop();
            var scrollHeight = $(document).height();
            var windowHeight = $(this).height();
            // 下拉
            if (scrollTop + windowHeight == scrollHeight) {
                if(page >= maxPage){
                    $.ajax({
                        type : "post",
                        url : url,
                        data : 'page=' + (page + 1),
                        dataType: 'json',
                        async : false,
                        success : function(data){
                            var html = template('j-product', data);
                            $('#j-product-box').append(html);
                            //rug
                            if(!isEmpty(data.list)){
                                page++;
                                localData.set('cat_4_page', page);
                                if(page > maxPage){
                                    localData.set('cat_4_page_max', page);
                                }
                            }
                        }
                    });
                }
            }
            // 上拉
            if(scrollTop == 0 && minPage > 1){
                $.ajax({
                    type : "post",
                    url : url,
                    data : 'page=' + (page - 1),
                    dataType: 'json',
                    async : false,
                    success : function(data){
                        var html = template('j-product', data);
                        $('#j-product-box').prepend(html);
                        page--;
                        localData.set('cat_4_page', page);
                        if(page < minPage){
                            localData.set('cat_4_page_min', page);
                        }
                    }
                });
            }
        });

        function get_data(page){
            $.ajax({
                type : "post",
                url : url,
                data : 'page=' + page,
                dataType: 'json',
                async : false,
                success : function(data){
                    var html = template('j-product', data);
                    $('#j-product-box').append(html);
                }
            });
        }

        /*
         * 检测对象是否是空对象(不包含任何可读属性)。
         * 方法既检测对象本身的属性，也检测从原型继承的属性(因此没有使hasOwnProperty)。
         */
        function isEmpty(obj) {
            for (var name in obj) {
                return false;
            }
            return true;
        }
        echo.init();
        $(function(){
            $('.ect-select').click(function(){
                var data = $(this).attr('data-attr');
                $(this).siblings('input[type="hidden"]').val(data);
            })
        })
        //属性
        $(function() {
            $('.j-sub-menu-attr li').click(function() {
                $(this).addClass('active').siblings('li').removeClass('active');
                var i = 0;
                var new_attr = new Array();
                $(".j-sub-menu-attr li").each(function(){
                    if ($(this).hasClass('active')) {
                        new_attr[i] = $(this).find('label').attr('value');
                        i = i + 1;
                    }
                });
                var new_attr_str = new_attr.join('.');
                //属性参数具体值
                $('input[name=filter_attr]').val(new_attr_str);
            })
        })
    </script>

</body>
</html>
